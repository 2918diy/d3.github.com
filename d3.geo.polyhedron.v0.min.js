(function(){function n(r,t){var o,e=[],a=r.edges,u=a.length,c=d3.geo.centroid({type:"MultiPoint",coordinates:r.face}),i=!1,f=-1;if(t)for(;u>++f&&a[f]!==t;);++f;for(var h=0;u>h;++h)o=a[(h+f)%u],Array.isArray(o)?(i||(e.push(d3.geo.interpolate(o[0],c)(p)),i=!0),e.push(d3.geo.interpolate(o[1],c)(p))):(i=!1,o!==t&&(e=e.concat(n(o,r))));return e}function r(n,r){for(var t,o,e=n.length,a=null,u=0;e>u;++u){t=n[u];for(var c=r.length;--c>=0;)if(o=r[c],t[0]===o[0]&&t[1]===o[1]){if(a)return[a,t];a=t}}}function t(n,r){var t=a(n[1],n[0]),o=a(r[1],r[0]),i=c(t,o),f=u(t)/u(o);return e([1,0,n[0][0],0,1,n[0][1]],e([f,0,0,0,f,0],e([Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0],[1,0,-r[0][0],0,1,-r[0][1]])))}function o(n){var r=1/(n[0]*n[4]-n[1]*n[3]);return[r*n[4],-r*n[1],r*(n[1]*n[5]-n[2]*n[4]),-r*n[3],r*n[0],r*(n[2]*n[3]-n[0]*n[5])]}function e(n,r){return[n[0]*r[0]+n[1]*r[3],n[0]*r[1]+n[1]*r[4],n[0]*r[2]+n[1]*r[5]+n[2],n[3]*r[0]+n[4]*r[3],n[3]*r[1]+n[4]*r[4],n[3]*r[2]+n[4]*r[5]+n[5]]}function a(n,r){return[n[0]-r[0],n[1]-r[1]]}function u(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function c(n,r){return Math.atan2(n[0]*r[1]-n[1]*r[0],n[0]*r[0]+n[1]*r[1])}function i(n,r){for(var t=0,o=n.length,e=0;o>t;++t)e+=n[t]*r[t];return e}function f(n,r){return[n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0]]}function h(n){return[Math.atan2(n[1],n[0])*M,Math.asin(Math.max(-1,Math.min(1,n[2])))*M]}function s(n){var r=n[0]*v,t=n[1]*v,o=Math.cos(t);return[o*Math.cos(r),o*Math.sin(r),Math.sin(t)]}function d(n,r){return n&&r&&n[0]===r[0]&&n[1]===r[1]}function l(n){for(var r=n.length,t=[],o=n[r-1],e=0;r>e;++e)t.push([o,o=n[e]]);return t}var p=1e-6,g=Math.PI,v=g/180,M=180/g;d3.geo.polyhedron=function(a,u){function c(n,o){if(n.edges=l(n.face),o)if(o.face){var a=n.shared=r(n.face,o.face),u=t(a.map(o.project),a.map(n.project));n.transform=o.transform?e(o.transform,u):u;for(var i=o.edges,f=0,h=i.length;h>f;++f)d(a[0],i[f][1])&&d(a[1],i[f][0])&&(i[f]=n),d(a[0],i[f][0])&&d(a[1],i[f][1])&&(i[f]=n);for(var i=n.edges,f=0,h=i.length;h>f;++f)d(a[0],i[f][0])&&d(a[1],i[f][1])&&(i[f]=o),d(a[0],i[f][1])&&d(a[1],i[f][0])&&(i[f]=o)}else n.transform=o.transform;return n.children&&n.children.forEach(function(r){c(r,n)}),n}function i(n,r){var t,o=u(n,r),e=o.project([n*M,r*M]);return(t=o.transform)?[t[0]*e[0]+t[1]*e[1]+t[2],-(t[3]*e[0]+t[4]*e[1]+t[5])]:(e[1]=-e[1],e)}function f(n,r){var t=n.transform,e=r;if(t&&(t=o(t),e=[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]),n===h(a=n.project.invert(e)))return a;for(var a,u=n.children,c=0,i=u&&u.length;i>c;++c)if(a=f(u[c],r))return a}function h(n){return u(n[0]*v,n[1]*v)}var s=-g/6;c(a,{transform:[Math.cos(s),Math.sin(s),0,-Math.sin(s),Math.cos(s),0]}),i.invert=function(n,r){var t=f(a,[n,-r]);return t?(t[0]*=v,t[1]*=v,t):[0/0,0/0]};var p=d3.geo.projection(i);return p.outline=function(){var r=n(a);return r.push(r[0]),{type:"Polygon",coordinates:[r]}},p},d3.geo.polyhedron.butterfly=function(n){n=n||function(n){var r=d3.geo.centroid({type:"MultiPoint",coordinates:n});return d3.geo.gnomonic().scale(1).translate([0,0]).rotate([-r[0],-r[1]])};var r=d3.geo.polyhedron.octahedron.map(function(r){return{face:r,project:n(r)}});return[-1,0,0,1,0,1,4,5].forEach(function(n,t){var o=r[n];o&&(o.children||(o.children=[])).push(r[t])}),d3.geo.polyhedron(r[0],function(n,t){return r[-g/2>n?0>t?6:4:0>n?0>t?2:0:g/2>n?0>t?3:1:0>t?7:5]})},d3.geo.polyhedron.waterman=function(n){function r(n,r){var t=Math.cos(r),o=[t*Math.cos(n),t*Math.sin(n),Math.sin(r)],a=-g/2>n?0>r?6:4:0>n?0>r?2:0:g/2>n?0>r?3:1:0>r?7:5,c=e[a];return u[0>i(c[0],o)?8+3*a:0>i(c[1],o)?8+3*a+1:0>i(c[2],o)?8+3*a+2:a]}n=n||function(n){var r=6===n.length?d3.geo.centroid({type:"MultiPoint",coordinates:n}):n[0];return d3.geo.gnomonic().scale(1).translate([0,0]).rotate([-r[0],-r[1]])};var t=d3.geo.polyhedron.octahedron,o=t.map(function(n){for(var r,t=n.map(s),o=t.length,e=t[o-1],a=[],u=0;o>u;++u)r=t[u],a.push(h([.9486832980505138*e[0]+.31622776601683794*r[0],.9486832980505138*e[1]+.31622776601683794*r[1],.9486832980505138*e[2]+.31622776601683794*r[2]]),h([.9486832980505138*r[0]+.31622776601683794*e[0],.9486832980505138*r[1]+.31622776601683794*e[1],.9486832980505138*r[2]+.31622776601683794*e[2]])),e=r;return a}),e=[],a=[-1,0,0,1,0,1,4,5];o.forEach(function(n,r){for(var u=t[r],c=u.length,i=e[r]=[],h=0;c>h;++h)o.push([u[h],n[(2*h+2)%(2*c)],n[(2*h+1)%(2*c)]]),a.push(r),i.push(f(s(n[(2*h+2)%(2*c)]),s(n[(2*h+1)%(2*c)])))});var u=o.map(function(r){return{project:n(r),face:r}});return a.forEach(function(n,r){var t=u[n];t&&(t.children||(t.children=[])).push(u[r])}),d3.geo.polyhedron(u[0],r).center([0,45])};var m=[[0,90],[-90,0],[0,0],[90,0],[180,0],[0,-90]];d3.geo.polyhedron.octahedron=[[0,2,1],[0,3,2],[5,1,2],[5,2,3],[0,1,4],[0,4,3],[5,4,1],[5,3,4]].map(function(n){return n.map(function(n){return m[n]})});var y=Math.atan(Math.SQRT1_2)*M,j=[[0,y],[90,y],[180,y],[-90,y],[0,-y],[90,-y],[180,-y],[-90,-y]];d3.geo.polyhedron.cube=[[0,3,2,1],[0,1,5,4],[1,2,6,5],[2,3,7,6],[3,0,4,7],[4,5,6,7]].map(function(n){return n.map(function(n){return j[n]})})})();