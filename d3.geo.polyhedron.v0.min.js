(function(){function n(r,t){var o,e=[],a=r.edges,c=a.length,u=d3.geo.centroid({type:"MultiPoint",coordinates:r.face}),i=!1,f=-1;if(t)for(;c>++f&&a[f]!==t;);++f;for(var h=0;c>h;++h)o=a[(h+f)%c],Array.isArray(o)?(i||(e.push(d3.geo.interpolate(o[0],u)(p)),i=!0),e.push(d3.geo.interpolate(o[1],u)(p))):(i=!1,o!==t&&(e=e.concat(n(o,r))));return e}function r(n,r){for(var t,o,e=n.length,a=null,c=0;e>c;++c){t=n[c];for(var u=r.length;--u>=0;)if(o=r[u],t[0]===o[0]&&t[1]===o[1]){if(a)return[a,t];a=t}}}function t(n,r){var t=e(n[1],n[0]),u=e(r[1],r[0]),i=c(t,u),f=a(t)/a(u);return o([1,0,n[0][0],0,1,n[0][1]],o([f,0,0,0,f,0],o([Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0],[1,0,-r[0][0],0,1,-r[0][1]])))}function o(n,r){return[n[0]*r[0]+n[1]*r[3],n[0]*r[1]+n[1]*r[4],n[0]*r[2]+n[1]*r[5]+n[2],n[3]*r[0]+n[4]*r[3],n[3]*r[1]+n[4]*r[4],n[3]*r[2]+n[4]*r[5]+n[5]]}function e(n,r){return[n[0]-r[0],n[1]-r[1]]}function a(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function c(n,r){return Math.atan2(n[0]*r[1]-n[1]*r[0],n[0]*r[0]+n[1]*r[1])}function u(n,r){for(var t=0,o=n.length,e=0;o>t;++t)e+=n[t]*r[t];return e}function i(n,r){return[n[1]*r[2]-n[2]*r[1],n[2]*r[0]-n[0]*r[2],n[0]*r[1]-n[1]*r[0]]}function f(n){return[Math.atan2(n[1],n[0])*v,Math.asin(Math.max(-1,Math.min(1,n[2])))*v]}function h(n){var r=n[0]*g,t=n[1]*g,o=Math.cos(t);return[o*Math.cos(r),o*Math.sin(r),Math.sin(t)]}function s(n,r){return n&&r&&n[0]===r[0]&&n[1]===r[1]}function d(n){for(var r=n.length,t=[],o=n[r-1],e=0;r>e;++e)t.push([o,o=n[e]]);return t}var p=1e-6,l=Math.PI,g=l/180,v=180/l;d3.geo.polyhedron=function(e,a){function c(n,e){if(n.edges=d(n.face),e)if(e.face){var a=n.shared=r(n.face,e.face),u=t(a.map(e.project),a.map(n.project));n.transform=e.transform?o(e.transform,u):u;for(var i=e.edges,f=0,h=i.length;h>f;++f)s(a[0],i[f][1])&&s(a[1],i[f][0])&&(i[f]=n),s(a[0],i[f][0])&&s(a[1],i[f][1])&&(i[f]=n);for(var i=n.edges,f=0,h=i.length;h>f;++f)s(a[0],i[f][0])&&s(a[1],i[f][1])&&(i[f]=e),s(a[0],i[f][1])&&s(a[1],i[f][0])&&(i[f]=e)}else n.transform=e.transform;return n.children&&n.children.forEach(function(r){c(r,n)}),n}var u=-l/6;c(e,{transform:[Math.cos(u),Math.sin(u),0,-Math.sin(u),Math.cos(u),0]});var i=d3.geo.projection(function(n,r){var t,o=a(n,r),e=o.project([n*v,r*v]);return(t=o.transform)?[t[0]*e[0]+t[1]*e[1]+t[2],-(t[3]*e[0]+t[4]*e[1]+t[5])]:(e[1]=-e[1],e)});return i.outline=function(){var r=n(e);return r.push(r[0]),{type:"Polygon",coordinates:[r]}},i},d3.geo.polyhedron.butterfly=function(n){n=n||function(n){var r=d3.geo.centroid({type:"MultiPoint",coordinates:n});return d3.geo.gnomonic().scale(1).translate([0,0]).rotate([-r[0],-r[1]])};var r=d3.geo.polyhedron.octahedron.map(function(r){return{face:r,project:n(r)}});return[-1,0,0,1,0,1,4,5].forEach(function(n,t){var o=r[n];o&&(o.children||(o.children=[])).push(r[t])}),d3.geo.polyhedron(r[0],function(n,t){return r[-l/2>n?0>t?6:4:0>n?0>t?2:0:l/2>n?0>t?3:1:0>t?7:5]})},d3.geo.polyhedron.waterman=function(n){function r(n,r){var t=Math.cos(r),o=[t*Math.cos(n),t*Math.sin(n),Math.sin(r)],a=-l/2>n?0>r?6:4:0>n?0>r?2:0:l/2>n?0>r?3:1:0>r?7:5,i=e[a];return c[0>u(i[0],o)?8+3*a:0>u(i[1],o)?8+3*a+1:0>u(i[2],o)?8+3*a+2:a]}n=n||function(n){var r=6===n.length?d3.geo.centroid({type:"MultiPoint",coordinates:n}):n[0];return d3.geo.gnomonic().scale(1).translate([0,0]).rotate([-r[0],-r[1]])};var t=d3.geo.polyhedron.octahedron,o=t.map(function(n){for(var r,t=n.map(h),o=t.length,e=t[o-1],a=[],c=0;o>c;++c)r=t[c],a.push(f([.9486832980505138*e[0]+.31622776601683794*r[0],.9486832980505138*e[1]+.31622776601683794*r[1],.9486832980505138*e[2]+.31622776601683794*r[2]]),f([.9486832980505138*r[0]+.31622776601683794*e[0],.9486832980505138*r[1]+.31622776601683794*e[1],.9486832980505138*r[2]+.31622776601683794*e[2]])),e=r;return a}),e=[],a=[-1,0,0,1,0,1,4,5];o.forEach(function(n,r){for(var c=t[r],u=c.length,f=e[r]=[],s=0;u>s;++s)o.push([c[s],n[(2*s+2)%(2*u)],n[(2*s+1)%(2*u)]]),a.push(r),f.push(i(h(n[(2*s+2)%(2*u)]),h(n[(2*s+1)%(2*u)])))});var c=o.map(function(r){return{project:n(r),face:r}});return a.forEach(function(n,r){var t=c[n];t&&(t.children||(t.children=[])).push(c[r])}),d3.geo.polyhedron(c[0],r).center([0,45])};var M=[[0,90],[-90,0],[0,0],[90,0],[180,0],[0,-90]];d3.geo.polyhedron.octahedron=[[0,2,1],[0,3,2],[5,1,2],[5,2,3],[0,1,4],[0,4,3],[5,4,1],[5,3,4]].map(function(n){return n.map(function(n){return M[n]})});var m=Math.atan(Math.SQRT1_2)*v,y=[[0,m],[90,m],[180,m],[-90,m],[0,-m],[90,-m],[180,-m],[-90,-m]];d3.geo.polyhedron.cube=[[0,3,2,1],[0,1,5,4],[1,2,6,5],[2,3,7,6],[3,0,4,7],[4,5,6,7]].map(function(n){return n.map(function(n){return y[n]})})})();